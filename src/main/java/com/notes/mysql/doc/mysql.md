#mysql

##基础架构
####mysql 基本架构示意图
![架构](https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png)

#### 大体来说mysql分为 server层 和 数据存储引擎俩部分
###  1. 连接器 
   负责和客户端建立连接、获取权限、保持连接以及管理连接
   建立连接、认证身份、确认权限（从权限表中查询拥有的权限，之后所有的操作都会依赖此时查询到的权限进行判定，期间管理员对此用户的权限
   进行修改也并不会影响已经建立的连接，当重新连接时修改的权限才会生效）
   连接 默认空闲超时时长为8小时
   - 长连接：数据库建立连接后，如果客户端持续有请求，则一直使用同一个连接。
   - 短连接：每次执行完很少的几次查询就断开连接，下次查询再重新建立连接。  
    尽量使用长连接以减少连接操作，但是时间长了会导致mysql服务占用内存涨的特别块，这是因为mysql在执行过程中使用的临时内存是管理在连接
     对象里的，这些资源会在连接断开的时候才释放，**_所以如果长期积累下来就可能导致内存占用过大，最终(OOM)，从现象上看就是mysql异常重启了。_**
   
**问题解决：**   
   1】 定期断开重连  
   2】 mysql5.7以及更高版本 可以在每执行一个较大的操作后，通过执行 mysql_reset_connection来重新初始化连接资源。这个
   过程不需要重连和重新做权限认证，只是将连接恢复到刚开始连接的时候。
     
    
### 2. 查询缓存  
执行sql要先查询缓存，缓存查询不到再执行后续操作，缓存以sql作为key查询结果作为value进行存储，只要对一个表有更新操作这个标上的缓存就会全部失效
mysql8.0之前提供了按需使用的策略，8.0之后该功能模块已被移除。

### 3.分析器
如果没有命中缓存就会开始真正执行sql语句了，首先要对sql语句进行解析
- 识别关键字 如表名、列名
- 语法分析 该sql语句是否符合mysql语法规范
### 4.优化器
如果sql语句没有问题 接下来就会对语句进行优化 例如：倘若存在索引需要确认使用那个索引；或者在一条语句中有多个表关联，决定各个表的连接顺序。
### 5.执行器
sql优化完毕就开始真正执行了，首先判断有没有对操作的表有权限



